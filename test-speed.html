<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Browser Speed Test - @svgies/icons</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            background: white;
            border-radius: 8px;
            padding: 30px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        h1 {
            margin-top: 0;
            color: #333;
        }
        button {
            background: #0070f3;
            color: white;
            border: none;
            padding: 12px 24px;
            font-size: 16px;
            border-radius: 6px;
            cursor: pointer;
            margin-bottom: 20px;
        }
        button:hover {
            background: #0051cc;
        }
        button:disabled {
            background: #ccc;
            cursor: not-allowed;
        }
        .status {
            padding: 12px;
            background: #f0f0f0;
            border-radius: 6px;
            margin-bottom: 20px;
            font-family: 'Courier New', monospace;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        th, td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }
        th {
            background: #f8f8f8;
            font-weight: 600;
        }
        .fastest {
            background: #d4edda;
        }
        .slowest {
            background: #f8d7da;
        }
        .summary {
            margin-top: 20px;
            padding: 15px;
            background: #e7f3ff;
            border-left: 4px solid #0070f3;
            border-radius: 4px;
        }
        .examples {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        .example {
            text-align: center;
            padding: 15px;
            background: #f8f8f8;
            border-radius: 8px;
        }
        .example h3 {
            margin-top: 0;
            font-size: 14px;
            color: #666;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üöÄ Browser Speed Test - @svgies/icons</h1>
        <p>Testing SVG generation performance for all supported chains in the browser.</p>
        
        <button id="runTest">Run Speed Test (100 iterations)</button>
        
        <div id="status" class="status">Ready to test...</div>
        
        <div id="results"></div>
        
        <div id="examples" class="examples"></div>
    </div>

    <script type="importmap">
    {
        "imports": {
            "@noble/hashes/sha2.js": "https://esm.sh/@noble/hashes@2.0.1/sha2.js",
            "@noble/hashes/sha3.js": "https://esm.sh/@noble/hashes@2.0.1/sha3.js"
        }
    }
    </script>
    <script type="module">
        import { arSvgie, evmSvgie, solanaSvgie, bitcoinSvgie } from './dist/index.mjs';

        const ITERATIONS = 100;
        const addresses = {
            arweave: 'E_pOZW6MDRtcTraQlIEM0p4l_AedIadAO9j-RzuPol8',
            evm: '0xA3Ca2a4BFb8Af380cf2D42e40A832E7a205db08e',
            solana: 'DYw8jCTfwHNRJhhmFcbXvVDTqWMEVFBX6ZKUmG5CNSKK',
            bitcoin: '1A1zP1eP5QGefi2DMPTfTL5SLmv7DivfNa'
        };

        async function benchmarkChain(name, fn, address) {
            const times = [];
            
            // Warmup
            for (let i = 0; i < 10; i++) {
                await fn(address, { size: 128 });
            }
            
            // Actual benchmark
            for (let i = 0; i < ITERATIONS; i++) {
                const start = performance.now();
                await fn(address, { size: 128 });
                const end = performance.now();
                times.push(end - start);
            }
            
            const avg = times.reduce((a, b) => a + b, 0) / times.length;
            const min = Math.min(...times);
            const max = Math.max(...times);
            const median = times.sort((a, b) => a - b)[Math.floor(times.length / 2)];
            
            return { avg, min, max, median };
        }

        async function generateExamples() {
            const examplesDiv = document.getElementById('examples');
            examplesDiv.innerHTML = '<h2>Generated Examples</h2>';
            
            for (const [chain, address] of Object.entries(addresses)) {
                const funcs = {
                    arweave: arSvgie,
                    evm: evmSvgie,
                    solana: solanaSvgie,
                    bitcoin: bitcoinSvgie
                };
                
                const dataUri = await funcs[chain](address, { size: 128, asDataURI: true });
                const div = document.createElement('div');
                div.className = 'example';
                div.innerHTML = `
                    <h3>${chain.charAt(0).toUpperCase() + chain.slice(1)}</h3>
                    <img src="${dataUri}" alt="${chain} identicon" width="128" height="128">
                `;
                examplesDiv.appendChild(div);
            }
        }

        async function runBenchmark() {
            const button = document.getElementById('runTest');
            const status = document.getElementById('status');
            const resultsDiv = document.getElementById('results');
            
            button.disabled = true;
            status.textContent = 'Running benchmarks...';
            resultsDiv.innerHTML = '';
            
            try {
                const results = {};
                
                // Test each chain
                for (const [chain, address] of Object.entries(addresses)) {
                    status.textContent = `Testing ${chain}... (${Object.keys(results).length + 1}/4)`;
                    
                    const funcs = {
                        arweave: arSvgie,
                        evm: evmSvgie,
                        solana: solanaSvgie,
                        bitcoin: bitcoinSvgie
                    };
                    
                    results[chain] = await benchmarkChain(chain, funcs[chain], address);
                }
                
                // Display results
                const fastest = Object.entries(results).reduce((a, b) => 
                    a[1].avg < b[1].avg ? a : b
                );
                const slowest = Object.entries(results).reduce((a, b) => 
                    a[1].avg > b[1].avg ? a : b
                );
                
                let html = '<table><thead><tr>';
                html += '<th>Chain</th><th>Avg (ms)</th><th>Min (ms)</th><th>Max (ms)</th><th>Median (ms)</th>';
                html += '</tr></thead><tbody>';
                
                for (const [chain, stats] of Object.entries(results)) {
                    const rowClass = chain === fastest[0] ? 'fastest' : chain === slowest[0] ? 'slowest' : '';
                    html += `<tr class="${rowClass}">`;
                    html += `<td><strong>${chain.charAt(0).toUpperCase() + chain.slice(1)}</strong></td>`;
                    html += `<td>${stats.avg.toFixed(3)}</td>`;
                    html += `<td>${stats.min.toFixed(3)}</td>`;
                    html += `<td>${stats.max.toFixed(3)}</td>`;
                    html += `<td>${stats.median.toFixed(3)}</td>`;
                    html += '</tr>';
                }
                
                html += '</tbody></table>';
                
                html += '<div class="summary">';
                html += `<strong>üèÜ Fastest:</strong> ${fastest[0]} (${fastest[1].avg.toFixed(3)}ms)<br>`;
                html += `<strong>üêå Slowest:</strong> ${slowest[0]} (${slowest[1].avg.toFixed(3)}ms)<br>`;
                html += `<strong>üìà Difference:</strong> ${((slowest[1].avg / fastest[1].avg - 1) * 100).toFixed(1)}% slower<br>`;
                html += `<strong>üåê Browser:</strong> ${navigator.userAgent.match(/(Chrome|Firefox|Safari|Edge)\/[\d.]+/)?.[0] || 'Unknown'}`;
                html += '</div>';
                
                resultsDiv.innerHTML = html;
                status.textContent = '‚úÖ Test completed!';
                
                // Generate visual examples
                await generateExamples();
                
            } catch (error) {
                status.textContent = '‚ùå Error: ' + error.message;
                console.error(error);
            } finally {
                button.disabled = false;
            }
        }

        // Attach event listener
        document.getElementById('runTest').addEventListener('click', runBenchmark);
    </script>
</body>
</html>

